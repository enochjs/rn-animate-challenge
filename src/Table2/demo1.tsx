import { SafeAreaView, View, useWindowDimensions } from 'react-native';
import Table from './components/Table';
import PreRender from './components/PreRenderTable';
import useRowsLayout from './hooks/useRowsLayout';
import { useMemo } from 'react';

export default function TableDemo() {
  const data = [
    {
      name1: 'name1',
      name2: 'name2',
      name3: 'name3',
      name4: 'name4',
      name5: 'name5name5name5name5name5',
      name6: 'name6',
      name7: 'name7',
      name8: 'name8',
      name9: 'name9',
      name10: 'name10',
      name11: 'name11',
      name12: 'name12',
      name13: 'name13',
      name14: 'name14',
      name15: 'name15',
      name16: 'name16',
      rowSpan: 3,
    },
    {
      name1: 'name1',
      name2: 'name2',
      name3: 'name3',
      name4: 'name4',
      name5: 'name5',
      name6: 'name6',
      name7: 'name7',
      name8: 'name8',
      name9: 'name9',
      name10: 'name10',
      name11: 'name11',
      name12: 'name12',
      name13: 'name13',
      name14: 'name14',
      name15: 'name15',
      name16: 'name16',
      rowSpan: 0,
    },
    {
      name1: 'name1',
      name2: 'name2',
      name3: 'name3',
      name4: 'name4',
      name5: 'name5',
      name6: 'name6',
      name7: 'name7',
      name8: 'name8',
      name9: 'name9',
      name10: 'name10',
      name11: 'name11',
      name12: 'name12',
      name13: 'name13',
      name14: 'name14',
      name15: 'name15',
      name16: 'name16',
      rowSpan: 0,
    },
    {
      name1: 'name1',
      name2: 'name2',
      name3: 'name3',
      name4: 'name4',
      name5: 'name5',
      name6: 'name6',
      name7: 'name7',
      name8: 'name8',
      name9: 'name9',
      name10: 'name10',
      name11: 'name11',
      name12: 'name12',
      name13: 'name13',
      name14: 'name14',
      name15: 'name15',
      name16: 'name16',
      rowSpan: 2,
    },
    {
      name1: 'name1',
      name2: 'name2',
      name3: 'name3',
      name4: 'name4',
      name5: 'name5',
      name6: 'name6',
      name7: 'name7',
      name8: 'name8',
      name9: 'name9',
      name10: 'name10',
      name11: 'name11',
      name12: 'name12',
      name13: 'name13',
      name14: 'name14',
      name15: 'name15',
      name16: 'name16',
      rowSpan: 0,
    },
    {
      name1: 'name1',
      name2: 'name2',
      name3: 'name3',
      name4: 'name4',
      name5: 'name5',
      name6: 'name6',
      name7: 'name7',
      name8: 'name8',
      name9: 'name9',
      name10: 'name10',
      name11: 'name11',
      name12: 'name12',
      name13: 'name13',
      name14: 'name14',
      name15: 'name15',
      name16: 'name16',
      rowSpan: 4,
    },
    {
      name1: 'name1',
      name2: 'name2',
      name3: 'name3',
      name4: 'name4',
      name5: 'name5',
      name6: 'name6',
      name7: 'name7',
      name8: 'name8',
      name9: 'name9',
      name10: 'name10',
      name11: 'name11',
      name12: 'name12',
      name13: 'name13',
      name14: 'name14',
      name15: 'name15',
      name16: 'name16',
      rowSpan: 0,
    },
    {
      name1: 'name1',
      name2: 'name2',
      name3: 'name3',
      name4: 'name4',
      name5: 'name5',
      name6: 'name6',
      name7: 'name7',
      name8: 'name8',
      name9: 'name9',
      name10: 'name10',
      name11: 'name11',
      name12: 'name12',
      name13: 'name13',
      name14: 'name14',
      name15: 'name15',
      name16: 'name16',
      rowSpan: 0,
    },
    {
      name1: 'name1',
      name2: 'name2',
      name3: 'name3',
      name4: 'name4',
      name5: 'name5',
      name6: 'name6',
      name7: 'name7',
      name8: 'name8',
      name9: 'name9',
      name10: 'name10',
      name11: 'name11',
      name12: 'name12',
      name13: 'name13',
      name14: 'name14',
      name15: 'name15',
      name16: 'name16',
      rowSpan: 0,
    },
    {
      name1: 'name1',
      name2: 'name2',
      name3: 'name3',
      name4: 'name4',
      name5: 'name5',
      name6: 'name6',
      name7: 'name7',
      name8: 'name8',
      name9: 'name9',
      name10: 'name10',
      name11: 'name11',
      name12: 'name12',
      name13: 'name13',
      name14: 'name14',
      name15: 'name15',
      name16: 'name16',
      rowSpan: 3,
    },
    {
      name1: 'name1',
      name2: 'name2',
      name3: 'name3',
      name4: 'name4',
      name5: 'name5',
      name6: 'name6',
      name7: 'name7',
      name8: 'name8',
      name9: 'name9',
      name10: 'name10',
      name11: 'name11',
      name12: 'name12',
      name13: 'name13',
      name14: 'name14',
      name15: 'name15',
      name16: 'name16',
      rowSpan: 0,
    },
    {
      name1: 'name1',
      name2: 'name2',
      name3: 'name3',
      name4: 'name4',
      name5: 'name5',
      name6: 'name6',
      name7: 'name7',
      name8: 'name8',
      name9: 'name9',
      name10: 'name10',
      name11: 'name11',
      name12: 'name12',
      name13: 'name13',
      name14: 'name14',
      name15: 'name15',
      name16: 'name16',
      rowSpan: 0,
    },
    {
      name1: 'name1',
      name2: 'name2',
      name3: 'name3',
      name4: 'name4',
      name5: 'name5',
      name6: 'name6',
      name7: 'name7',
      name8: 'name8',
      name9: 'name9',
      name10: 'name10',
      name11: 'name11',
      name12: 'name12',
      name13: 'name13',
      name14: 'name14',
      name15: 'name15',
      name16: 'name16',
    },
    {
      name1: 'name1',
      name2: 'name2',
      name3: 'name3',
      name4: 'name4',
      name5: 'name5',
      name6: 'name6',
      name7: 'name7',
      name8: 'name8',
      name9: 'name9',
      name10: 'name10',
      name11: 'name11',
      name12: 'name12',
      name13: 'name13',
      name14: 'name14',
      name15: 'name15',
      name16: 'name16',
    },
    {
      name1: 'name1',
      name2: 'name2',
      name3: 'name3',
      name4: 'name4',
      name5: 'name5',
      name6: 'name6',
      name7: 'name7',
      name8: 'name8',
      name9: 'name9',
      name10: 'name10',
      name11: 'name11',
      name12: 'name12',
      name13: 'name13',
      name14: 'name14',
      name15: 'name15',
      name16: 'name16',
    },
    {
      name1: 'name1',
      name2: 'name2',
      name3: 'name3',
      name4: 'name4',
      name5: 'name5',
      name6: 'name6',
      name7: 'name7',
      name8: 'name8',
      name9: 'name9',
      name10: 'name10',
      name11: 'name11',
      name12: 'name12',
      name13: 'name13',
      name14: 'name14',
      name15: 'name15',
      name16: 'name16',
    },
    {
      name1: 'name1',
      name2: 'name2',
      name3: 'name3',
      name4: 'name4',
      name5: 'name5',
      name6: 'name6',
      name7: 'name7',
      name8: 'name8',
      name9: 'name9',
      name10: 'name10',
      name11: 'name11',
      name12: 'name12',
      name13: 'name13',
      name14: 'name14',
      name15: 'name15',
      name16: 'name16',
    },
    {
      name1: 'name1',
      name2: 'name2',
      name3: 'name3',
      name4: 'name4',
      name5: 'name5',
      name6: 'name6',
      name7: 'name7',
      name8: 'name8',
      name9: 'name9',
      name10: 'name10',
      name11: 'name11',
      name12: 'name12',
      name13: 'name13',
      name14: 'name14',
      name15: 'name15',
      name16: 'name16',
    },
    {
      name1: 'name1',
      name2: 'name2',
      name3: 'name3',
      name4: 'name4',
      name5: 'name5',
      name6: 'name6',
      name7: 'name7',
      name8: 'name8',
      name9: 'name9',
      name10: 'name10',
      name11: 'name11',
      name12: 'name12',
      name13: 'name13',
      name14: 'name14',
      name15: 'name15',
      name16: 'name16',
    },
    {
      name1: 'name123',
      name2: 'name2',
      name3: 'name3',
      name4: 'name4',
      name5: 'name5',
      name6: 'name6',
      name7: 'name7',
      name8: 'name8',
      name9: 'name9',
      name10: 'name10',
      name11: 'name11',
      name12: 'name12',
      name13: 'name13',
      name14: 'name14',
      name15: 'name15',
      name16: 'name16',
    },
  ];

  const columns: any[] = Array.from({ length: 16 }).map((item, index) => ({
    title: `name${index + 1}`,
    dataIndex: `name${index + 1}`,
    width: 80 + index * 10,
    rowSpanKey: index === 0 ? 'rowSpan' : undefined,
  }));

  const { heightArr, handleLayout } = useRowsLayout(data.length);

  const dimensions = useWindowDimensions();

  const viewWidth = dimensions.width;

  const { widthArr, flexArr } = useMemo(() => {
    let totalWidth = 0;
    const widthArr: number[] = [];
    columns.forEach((c) => {
      totalWidth += c.width;
      widthArr.push(c.width);
    });
    return {
      rowWidth: totalWidth < viewWidth ? viewWidth : totalWidth,
      widthArr: totalWidth < viewWidth ? undefined : widthArr,
      flexArr: totalWidth < viewWidth ? widthArr : undefined,
    };
  }, [columns, viewWidth]);

  return (
    <SafeAreaView>
      <View>
        <PreRender onLayout={handleLayout} data={data} columns={columns} widthArr={widthArr} flexArr={flexArr} />
        <Table columns={columns} data={data} heightArr={heightArr} />
      </View>
    </SafeAreaView>
  );
}
